function rcpStripeSubmitBillingCardUpdate(e){e.preventDefault();let t=document.querySelector(".rcp_card_name").value,r=jQuery("#rcp_submit"),a=jQuery("#rcp_update_card_form"),n=jQuery('input[name="rcp_gateway_existing_payment_method"]:checked').val();"new"===n&&(n=!1),n||""!==t?(r.prop("disabled",!0),a.block({message:rcp_stripe_script_options.pleasewait,css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"}}),jQuery.ajax({type:"post",dataType:"json",url:rcp_stripe_script_options.ajaxurl,data:{action:"rcp_stripe_create_setup_intent_for_saved_card",membership_id:jQuery('input[name="rcp_membership_id"]').val(),payment_method_id:n||"new"},success:function(e){if(e.success){let r={payment_method_data:{billing_details:{name:t}}};n&&(r={payment_method:n});let a="payment_intent"===e.data.payment_intent_object?"handleCardPayment":"handleCardSetup";rcpStripeHandleIntent(a,e.data.payment_intent_client_secret,r).then(function(t){t.error?rcpStripeHandleCardUpdateError(t.error.message,t.error.code):rcpStripeHandleCardUpdateSuccess(e)})}else rcpStripeHandleCardUpdateError(e.data)}})):rcpStripeHandleCardUpdateError(rcp_stripe_script_options.enter_card_name)}function rcpStripeHandleCardUpdateSuccess(e){let t=document.createElement("input");t.value=e.data.payment_intent_id,t.type="hidden",t.name="stripe_payment_intent_id",form.appendChild(t);let r=document.createElement("input");r.value=e.data.payment_intent_object,r.type="hidden",r.name="stripe_payment_intent_object",form.appendChild(r),form.removeEventListener("submit",rcpStripeSubmitBillingCardUpdate),form.submit()}function rcpStripeHandleCardUpdateError(e,t=""){""!==t&&void 0!==rcpStripe.errors[t]&&(e=rcpStripe.errors[t]),jQuery("#rcp_update_card_form").unblock(),rcpStripeToggleElementErrors({error:{message:e}}),jQuery("#rcp_submit").prop("disabled",!1)}!function(){var e=document.getElementById("rcp-card-wrapper");if(!e)return;let t=jQuery;if(!document.getElementById("rcp-card-element")||!document.getElementById("rcp-card-element-errors")){e.innerHTML="";var r=document.createElement("div");r.id="rcp-card-element-errors";var a=document.createElement("div");a.id="rcp-card-element",e.appendChild(a),e.appendChild(r)}rcpStripeUpdateElementStyles(rcpStripe.elements.card,".rcp_card_name"),rcpStripe.elements.card.mount("#rcp-card-element"),rcpStripe.elements.card.addEventListener("change",rcpStripeToggleElementErrors);let n=t('input[name="rcp_gateway_existing_payment_method"]'),p=t(".rcp-gateway-new-card-fields");n.on("change",function(){"new"===t('input[name="rcp_gateway_existing_payment_method"]:checked').val()?p.show():p.hide()}),n.trigger("change");var d={init:function(){t(".rcp-gateway-saved-card-delete").on("click","a",d.delete)},delete:function(e){if(e.preventDefault(),!confirm(rcp_stripe_script_options.confirm_delete_card))return!1;let r=t(this),a=t("#rcp-card-element-errors");r.data("text",r.text()).text(rcp_stripe_script_options.pleasewait),a.empty(),t.ajax({type:"post",dataType:"json",url:rcp_stripe_script_options.ajaxurl,data:{action:"rcp_stripe_delete_saved_payment_method",payment_method_id:r.data("id"),nonce:r.data("nonce")},xhrFields:{withCredentials:!0},success:function(e){e.success?r.parents("li").remove():(console.log(e),a.append('<div class="rcp_message error"><p class="rcp_error"><span>'+e.data+"</span></p></div>"),r.text(r.data("text")))}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}};d.init()}();var form=document.getElementById("rcp_update_card_form");form.addEventListener("submit",rcpStripeSubmitBillingCardUpdate);
